<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Contact</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <nav class="navbar">
    <div class="navbar-section navbar-left">
      <a href="index.html" class="nav-btn nav-home" style="text-decoration: none;" data-i18n="home">Home</a>
      <a href="About.html" class="nav-btn" style="text-decoration: none;" data-i18n="about">About me</a>
    </div>
    <div class="navbar-section navbar-center">
      <a href="index.html" class="nav-btn nav-copyright" style="text-decoration: none;" data-i18n="copyright">© Code by Ishan</a>
    </div>
    <div class="navbar-section navbar-right">
      <div class="nav-dropdown-wrapper">
        <button class="nav-btn nav-work" id="navWorkBtn" data-i18n="work">
          <span data-i18n="work">Work</span>
        </button>
        <div class="nav-dropdown" id="navWorkDropdown">
          <a href="EV multiplatform.html" class="nav-dropdown-item" data-i18n="ev">EV Multiplatform</a>
        </div>
      </div>
      <a href="contact.html" class="nav-btn" style="text-decoration: none;" data-i18n="contact">Contact me</a>
    </div>
  </nav>

  <div class="contact-container">
    <!-- Contact form -->
    <form id="contactForm" class="contact-form" method="POST" action="/api/contact">
      <div class="contact-form-header">
        <h2>Got ideas? We’ve got the skills. Let’s team up.</h2>
        <div class="contact-form-sub">Tell us more about yourself and what you’ve got in mind.</div>
      </div>

      <div class="contact-form-group">
        <input type="text" class="contact-input" name="name" placeholder="Your name" required />
        <input type="email" class="contact-input" name="email" placeholder="you@company.com" required />
        <textarea class="contact-input" name="message" rows="3" placeholder="Tell us a little about the project..." required></textarea>
      </div>

      <div class="contact-form-group">
        <div class="contact-form-label">How can we help?</div>
        <div class="contact-checkbox-row">
          <label><input type="checkbox" name="help" value="Sign NDA"> I want to sign NDA</label>
        </div>
      </div>

      <!-- Honeypot field (spam trap) -->
      <input type="text" name="website" style="display:none" tabindex="-1" autocomplete="off" />

      <!-- Cloudflare Turnstile (AUTO-render: exactly one badge) -->
      <div class="cf-turnstile" data-sitekey="0x4AAAAAABz_zHTAN2QnkjXF"></div>

      <button type="submit" class="contact-form-btn">Let's get started!</button>

      <!-- Feedback messages -->
      <div id="formSuccess" style="font-size: 20px; font-weight: 600; display:none;margin-top:10px;color:#0a8f3c;">Received your request! I will contact you within 24 hours!</div>
      <div id="formError" style="display:none;margin-top:10px;color:#b00020;">Sorry—something went wrong. Please try again.</div>
    </form>
  </div>

  <!-- Your other scripts (optional) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
  <script src="navbar-responsive.js"></script>
  <script src="navbar.js"></script>
  <script src="script.js"></script>
  <script src="localization.js"></script>

  <!-- Turnstile API (loads and auto-renders the widget above) -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

  <!-- Minimal, robust submit handler -->
  <script>
    (function () {
      const form = document.getElementById("contactForm");
      const ok = document.getElementById("formSuccess");
      const err = document.getElementById("formError");

      form.addEventListener("submit", async function (e) {
        e.preventDefault();
        ok.style.display = "none";
        err.style.display = "none";
        err.textContent = "Sorry—something went wrong. Please try again.";

        // Ensure Turnstile has produced a token (auto-render inserts a hidden input)
        const token = form.querySelector('input[name="cf-turnstile-response"]')?.value || "";
        if (!token) {
          err.textContent = "Security check is still loading. Please wait a moment and try again.";
          err.style.display = "block";
          return;
        }

        try {
          const res = await fetch(form.action, { method: "POST", body: new FormData(form) });
          if (res.ok) {
            ok.style.display = "block";
            form.reset();
            // Turnstile will auto-refresh the token after a while; no manual reset needed.
          } else {
            const text = await res.text();
            err.textContent = text || "Sorry—something went wrong. Please try again.";
            err.style.display = "block";
          }
        } catch {
          err.textContent = "Network error. Please try again.";
          err.style.display = "block";
        }
      });
    })();
  </script>
</body>
</html>
